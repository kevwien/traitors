<!DOCTYPE html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>FARMHOUSE: Traitors</title>
    <link rel="icon" href="favicon.svg">
    <link rel="mask-icon" href="mask-icon.svg" color="#FFFFFF">
    <link rel="apple-touch-icon" href="apple-touch-icon.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Rowdies:wght@300;400;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Indie+Flower&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" rel="stylesheet">
    <style>
        body {
            background: rgb(3, 0, 17);
            background-image: url("images/background.jpg");
            background-position: bottom;
            background-repeat: no-repeat;
            background-size: 100vw 100vh;
            background-blend-mode: normal;
            background-attachment: fixed;
        }

        h1 {
            font-size: 400%;
            color: rgb(235, 190, 235);
            font-family: "Rowdies", sans-serif;
            font-weight: 900;
            font-style: normal;
            text-align: center;
            margin: 40px 0px 20px 0px;
        }

        h2 {
            font-size: 500%;
            color: rgb(189, 101, 189);
            font-family: "Indie Flower", cursive;
            font-weight: 400;
            font-style: normal;
            text-align: center;
            margin: 0px;
        }

        .flex-container {
            padding: 2% 0 0 0;
            display: flex;
            flex-flow: row wrap;
        }

        .flex-item {
            padding: 10px;
            flex: 1 1 100px;
            text-align: center;
        }

        .name {
            font-size: 150%;
            color: rgb(235, 190, 235);
            font-family: "Roboto", sans-serif;
            font-weight: 700;
            font-style: normal;
        }

        .player {
            position: relative;
            cursor: pointer;
        }

        .player.alive > .avatar > .skull {
            display: none;
        }

        .player.dead > .avatar > .skull {
            display: block;
            position: absolute;
            width: 40%;
            height: 40%;
            top: 10px;
            z-index: 999;
            left: 10px;
            color: white;
        }

        .player > .avatar > img {
            height: 150px;
            object-fit: contain;
            border-radius: 100%;
        }

        .player > .avatar { 
            border-radius: 100%;
            flex: 20%;
            transition: all 0.3s ease;
            margin: 0px;
            display: inline-block;
            position: relative;
        }

        .player > .avatar:hover {
            transform: scale(1.1);
        }

        .player.dead > .avatar:hover {
            transform: scale(1.1);
        }

        .player.alive > .avatar { 
            background: transparent;
        }

        .player.dead > .avatar { 
            background: red;
        }

        .player.alive > .avatar > img { 
            border: 5px solid transparent;
            mix-blend-mode: normal;
            padding: 10px;
        }

        .player.dead > .avatar > img { 
            border: 5px solid red;
            mix-blend-mode: multiply;
            padding: 10px 10px 5px 10px;
        }

        .player.dead > .name {
            padding: 5px 0 0 0;
        }

        .flex-item.banner {
            display: block;
            position: absolute;
            top: 20px;
            text-align: center;
        }

        /* Responsive layout - makes a one column layout instead of a two-column layout */
        @media (max-width: 800px) {
            body {
                background-image: none;
            }

            .flex-item {
                flex: 20%;
            }
        }
    </style>
</head>
<body>
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js""></script>

    <div id="app">
        <div class="flex-container">
            <div class="flex-item" v-on:click="togglePlayer(player)" v-for="player in players">
                <div class="player" :class="player.status">
                    <div class="avatar">
                        <svg class="skull" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="#FFFFFF" d="M416 398.9c58.5-41.1 96-104.1 96-174.9C512 100.3 397.4 0 256 0S0 100.3 0 224c0 70.7 37.5 133.8 96 174.9c0 .4 0 .7 0 1.1v64c0 26.5 21.5 48 48 48h48V464c0-8.8 7.2-16 16-16s16 7.2 16 16v48h64V464c0-8.8 7.2-16 16-16s16 7.2 16 16v48h48c26.5 0 48-21.5 48-48V400c0-.4 0-.7 0-1.1zM96 256a64 64 0 1 1 128 0A64 64 0 1 1 96 256zm256-64a64 64 0 1 1 0 128 64 64 0 1 1 0-128z"/></svg>
                        <img :src="player.image" :alt="player.name" />
                    </div>
                    <div class="name">{{player.name}}</div>
                </div>
            </div>
        </div>
        <h1>FARMHOUSE 2024</h1>
        <h2>TRAITORS</h2>
    </div>

    <script>
        Vue.createApp({
            data() {
                return {
                    players: [
                        { name: "Bobby", gender: "male", status: "alive", image: "images/bobby.jpg" },
                        { name: "Laura", gender: "female", status: "alive", image: "images/laura.jpg" },
                        { name: "Kevin W.", gender: "male", status: "alive", image: "images/kevin_w.jpg" },
                        { name: "Lexi", gender: "female", status: "alive", image: "images/lexi.jpg" },
                        { name: "Grayson", gender: "male", status: "alive", image: "images/grayson.jpg" },
                        { name: "Ingrid", gender: "female", status: "alive", image: "images/ingrid.jpg" },
                        { name: "Adam", gender: "male", status: "alive", image: "images/adam.png" },
                        { name: "Randle", gender: "male", status: "alive", image: "images/randle.jpg" },
                        { name: "Stephanie", gender: "female", status: "alive", image: "images/stephanie.png" },
                        { name: "Charles", gender: "male", status: "alive", image: "images/charles.jpg" },
                        { name: "Kevin O.", gender: "male", status: "alive", image: "images/kevin_o.png" },
                        { name: "Jesse", gender: "male", status: "alive", image: "images/jesse.jpg" },
                        { name: "Angela", gender: "female", status: "alive", image: "images/angela.jpg" },
                        { name: "Brandon", gender: "male", status: "alive", image: "images/brandon.jpg" },
                        { name: "Alex C.", gender: "male", status: "alive", image: "images/alex_c.jpg" },
                        { name: "Alex G.", gender: "female", status: "alive", image: "images/alex_g.jpg" }
                    ]
                }
            },
            created() {
                let urlParams = new URLSearchParams(window.location.search);
                if (urlParams.has("s")) {
                    param = urlParams.get("s");
                    this.decodeURL(param);
                }
            },
            methods: {
                togglePlayer: function(player) {
                    if (player.status === "alive") {
                        player.status = "dead";
                        this.playKillAudio(player);
                        console.debug("Player '" + player.name + "' has been eliminated");
                    } else {
                        player.status = "alive";
                        this.playReviveAudio(player);
                        console.debug("Player '" + player.name + "' has been brought back to life");
                    } 
                    
                    this.encodeURL();
                },
                playKillAudio: function(player) {
                    var audio = null
                    if (player.gender === "male") {
                        audio = new Audio("audio/male.mp3");
                    } else if (player.gender === "female") {
                        audio = new Audio("audio/female.mp3");
                    }
                    audio.play();

                    audio = new Audio("audio/shot.mp3");
                    audio.play();
                },
                playReviveAudio: function(player) {
                    var audio = null
                    if (player.gender === "male") {
                        audio = new Audio("audio/male-revive.mp3");
                    } else if (player.gender === "female") {
                        audio = new Audio("audio/female-revive.mp3");
                    }
                    audio.play();
                },
                encodeURL: function() {
                    // Encode player statuses into binary, then convert to hex, then inject into URL
                    var binaryString = "";
                    var hexString = "";

                    this.players.forEach(player => {
                        if (player.status === "alive") {
                            binaryString += "1";
                        } else {
                            binaryString += "0";
                        }
                    });

                    var bytes = binaryString.match(/.{1,8}/g);
                    bytes.forEach(byte => {
                        hexString += parseInt(byte, 2).toString(16).padStart(2, '0');
                    });
                    
                    if ('URLSearchParams' in window) {
                        const url = new URL(window.location);
                        url.searchParams.set("s", hexString);
                        history.pushState(null, "", url);
                    }
                },
                decodeURL: function(hexString) {
                    // Decode URL as hex into binary, then use bits to set player statuses
                    var binaryString = "";
                    var hexDigits = hexString.match(/.{1,2}/g);

                    hexDigits.forEach(hex => {
                        binaryString += (parseInt(hex, 16).toString(2)).padStart(8, '0');
                    });
                    
                    for (var i = 0; i < binaryString.length; i++) {
                        if (binaryString[i] === "1") {
                            this.players[i].status = "alive";
                        } else {
                            this.players[i].status = "dead";
                        }
                    }
                }
            }
        }).mount('#app')
    </script>
</body>